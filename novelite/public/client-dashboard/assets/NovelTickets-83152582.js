var be=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var G=(a,i,r)=>i in a?be(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,I=(a,i)=>{for(var r in i||(i={}))ge.call(i,r)&&G(a,r,i[r]);if(Z)for(var r of Z(i))ve.call(i,r)&&G(a,r,i[r]);return a};import{e as T,j as e,au as k,bY as y,r as p,bZ as J,b_ as K,bV as Ce,as as ye,L as Te,b$ as ke,bX as _e}from"./index-f22446e5.js";import{B as Se}from"./Breadcrumb-c1517ab0.js";import{P as we}from"./PageContainer-53646ac6.js";import{C as Le}from"./ChildCard-37e943a8.js";import{B as n}from"./Box-f8c4e902.js";import{G as C}from"./Grid-6c01a67e.js";import{s as Ie,T as l}from"./Typography-493ceae3.js";import{u as ie}from"./useDispatch-ce130263.js";import{r as D,i as P}from"./createSvgIcon-0049ca4f.js";import{k as Oe,Q}from"./ReactToastify-7587e975.js";import{F as U}from"./FormControl-902fa994.js";import{I as X,T as O}from"./TextField-eaaf417f.js";import{S as Y}from"./Select-8c02317b.js";import{M as ee}from"./MenuItem-65e34cdb.js";import{B as _}from"./Button-7d294087.js";import{T as De,a as Pe,b as $e,c as te,d as b,e as Ne}from"./TableRow-5d89add1.js";import{C as Re}from"./Chip-22604cd4.js";import{B as se}from"./Badge-98ae8b85.js";import{P as Be}from"./Pagination-3bcc2fb9.js";import{M as He}from"./Modal-99caf082.js";import{D as re}from"./DialogActions-04b28c99.js";import{D as Ae,a as Ve}from"./DialogContent-4bed6d00.js";import{D as Me}from"./DialogTitle-b1205a27.js";import{T as We}from"./Tooltip-c24d37bb.js";import{Z as Fe}from"./Zoom-1ac67b22.js";import"./index.esm-e0300107.js";import"./Link-f430d0ec.js";import"./Card-99a14ea7.js";import"./Paper-eafa25ad.js";import"./CardHeader-53ac68d8.js";import"./Divider-efe6cf9e.js";import"./dividerClasses-0b6de4a8.js";import"./CardContent-621adc32.js";import"./createChainedFunction-0bab83cf.js";import"./ownerWindow-698471fc.js";import"./ownerDocument-613eb639.js";import"./isMuiElement-0a1be5b6.js";import"./useId-6ded1857.js";import"./useControlled-7a3bcd39.js";import"./clsx.m-1229b3e0.js";import"./utils-5ebfb48b.js";import"./useFormControl-c5cffc22.js";import"./formControlState-02eb4045.js";import"./Popover-9060c6fe.js";import"./Grow-1067b88b.js";import"./utils-e57cfcaa.js";import"./List-24f7ff12.js";import"./ListContext-74b9cccd.js";import"./InputBase-6d6630d9.js";import"./listItemIconClasses-5a5c13b9.js";import"./listItemTextClasses-243cffc5.js";import"./usePreviousProps-bc01b69b.js";import"./LastPage-13b3e262.js";import"./Fade-6b4e951e.js";import"./Portal-bdf58041.js";import"./Popper-7c45775d.js";import"./createPopper-319e19c4.js";const S=Ie(n)(()=>({padding:"30px",transition:"0.1s ease-in",cursor:"pointer",color:"inherit","&:hover":{transform:"scale(1.03)"}})),ze=({userEmail:a,filterLocation:i})=>{const r=ie(),m=T(s=>s.ticketReducer.tickets);m&&m.filter(s=>s.status==="On Hold").length,m&&m.filter(s=>s.status==="Open").length,m&&m.filter(s=>s.status==="Closed").length;const h=()=>{const{data:s}=y("Issue",[["raised_by","=",a],i==="ALL"?null:["location","=",i]],!1);return s||0},j=()=>{const{data:s}=y("Issue",[["status","=","closed"],["raised_by","=",a],i==="ALL"?null:["location","=",i]],!1);return s||0},v=()=>{const{data:s}=y("Issue",[["status","=","on hold"],["raised_by","=",a],i==="ALL"?null:["location","=",i]],!1);return s||0},g=()=>{const{data:s}=y("Issue",[["status","=","open"],["raised_by","=",a],i==="ALL"?null:["location","=",i]],!1);return s||0};return e.jsxs(C,{container:!0,spacing:3,textAlign:"center",children:[e.jsx(C,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(S,{onClick:()=>r(k("Open")),sx:{backgroundColor:"success.light",color:"success.main"},children:[e.jsx(l,{variant:"h3",children:g()}),e.jsx(l,{variant:"h6",children:"New Tickets"})]})}),e.jsx(C,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(S,{onClick:()=>r(k("On Hold")),sx:{backgroundColor:"warning.light",color:"warning.main"},children:[e.jsx(l,{variant:"h3",children:v()}),e.jsx(l,{variant:"h6",children:"On Hold Tickets"})]})}),e.jsx(C,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(S,{onClick:()=>r(k("Closed")),sx:{backgroundColor:"error.light",color:"error.main"},children:[e.jsx(l,{variant:"h3",children:j()}),e.jsx(l,{variant:"h6",children:"Closed Tickets"})]})}),e.jsx(C,{item:!0,xs:6,sm:6,lg:3,children:e.jsxs(S,{onClick:()=>r(k("total_tickets")),sx:{backgroundColor:"primary.light",color:"primary.main"},children:[e.jsx(l,{variant:"h3",children:h()}),e.jsx(l,{variant:"h6",children:"Total Tickets"})]})})]})},qe=ze;var $={},Ee=P;Object.defineProperty($,"__esModule",{value:!0});var ae=$.default=void 0,Ze=Ee(D()),Ge=e,Je=(0,Ze.default)((0,Ge.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"}),"ChatBubbleOutline");ae=$.default=Je;var N={},Ke=P;Object.defineProperty(N,"__esModule",{value:!0});var oe=N.default=void 0,Qe=Ke(D()),Ue=e,Xe=(0,Qe.default)((0,Ue.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");oe=N.default=Xe;var R={},Ye=P;Object.defineProperty(R,"__esModule",{value:!0});var le=R.default=void 0,et=Ye(D()),tt=e,st=(0,et.default)((0,tt.jsx)("path",{d:"m10.54 11-.54-.54L7.54 8 6 6.46 2.38 2.84 1.27 1.73 0 3l2.01 2.01L2 22l4-4h9l5.73 5.73L22 22.46 17.54 18l-7-7zM8 14H6v-2h2v2zm-2-3V9l2 2H6zm14-9H4.08L10 7.92V6h8v2h-7.92l1 1H18v2h-4.92l6.99 6.99C21.14 17.95 22 17.08 22 16V4c0-1.1-.9-2-2-2z"}),"SpeakerNotesOff");le=R.default=st;const rt={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",border:"none",boxShadow:24,p:4},it=({userEmail:a,totalPages:i,confirmedLocations:r,setFilterLocation:m,filterLocation:h})=>{const j=ie(),[v,g]=p.useState(!1),[s,d]=p.useState(!1);p.useState(!1);const[w,B]=p.useState(0),[H,L]=p.useState(""),[A,ne]=p.useState(""),[ce,de]=p.useState("");p.useState("");const[x,V]=p.useState({subject:"",description:"",location:h}),ue=(t,o)=>{o=o-1,B(o*10)},M=t=>{m(t.target.value),j(ke(t.target.value)),x.location=t.target.value,V(I({},x)),t.target.value!=="Property Location"&&localStorage.setItem("location",t.target.value)};if(h==="ALL"){const{data:t,error:o,isValidating:c,mutate:u}=J("Issue",{fields:["subject","creation","status","raised_by","name","description","location"],filters:[["raised_by","=",a]],limit_start:w,limit:10,orderBy:{field:"creation",order:"desc"}});var f=[];t&&(j(K(t)),f=t)}else{const{data:t,error:o,isValidating:c,mutate:u}=J("Issue",{fields:["subject","creation","status","raised_by","name","description","location"],filters:[["raised_by","=",a],["location","=",h]],limit_start:w,limit:10,orderBy:{field:"creation",order:"desc"}});var f=[];t&&(j(K(t)),f=t)}const me=()=>{g(!0)},W=()=>{g(!1)},he=(t,o,c)=>{d(!0),L(t),ne(o),de(c)},F=()=>d(!1),pe=(t,o,c)=>{if(t!=null)switch(o){case"total_tickets":return t.filter(u=>u.subject.toLocaleLowerCase().includes(c));case"On Hold":return t.filter(u=>u.status==="On Hold"&&u.subject.toLocaleLowerCase().includes(c));case"Closed":return t.filter(u=>u.status==="Closed"&&u.subject.toLocaleLowerCase().includes(c));case"Open":return t.filter(u=>u.status==="Open"&&u.subject.toLocaleLowerCase().includes(c));default:throw new Error(`Unknown filter: ${o}`)}};f!=null&&(f=T(t=>pe(t.ticketReducer.tickets,t.ticketReducer.currentFilter,t.ticketReducer.ticketSearch)));const{createDoc:xe,isCompleted:lt}=Ce(),je=t=>Q.success(t,{toastId:"success"}),z=t=>Q.warn(t,{toastId:"warn"}),q=t=>{var u,E;const o=(u=document.querySelector("#standard-basic"))==null?void 0:u.value.trim(),c=(E=document.querySelector("#outlined-multiline-static"))==null?void 0:E.value.trim();o!==""&&c!==""&&(x.subject=o,x.description=c,V(I({},x)))},fe=()=>{x.subject===""||x.description===""?z("Please fill the details"):x.location==="ALL"||x.location===""?z("Please Select the Location"):xe("Issue",x).then(()=>{je("Ticket created Successfully"),g(!1),mutate()}).catch(t=>{console.log("inside catch "+JSON.stringify(t.message)),notifyError(t.message)})};return e.jsxs(n,{mt:4,children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(n,{}),e.jsx(n,{sx:{mb:2},children:r&&e.jsxs(U,{sx:{m:1,minWidth:170},children:[e.jsx(X,{id:"demo-simple-select-autowidth-label",children:"Property Location"}),e.jsx(Y,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:h,label:"Property Location",onChange:M,children:r==null?void 0:r.map((t,o)=>e.jsx(ee,{value:t,children:t},o))})]})})]}),e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(n,{children:e.jsxs(_,{variant:"contained",onClick:me,children:["New Â ",e.jsx(oe,{})]})}),e.jsx(n,{sx:{ml:"auto"},display:"flex",justifyContent:"space-between",alignItems:"center",children:e.jsx(O,{size:"small",label:"Search",fullWidth:!0,onChange:t=>j(ye(t.target.value))})})]}),e.jsx(De,{children:e.jsxs(Pe,{children:[e.jsx($e,{children:e.jsxs(te,{children:[e.jsx(b,{children:e.jsx(l,{variant:"h6",children:"Ticket"})}),e.jsx(b,{children:e.jsx(l,{variant:"h6",children:"Status"})}),e.jsx(b,{children:e.jsx(l,{variant:"h6",children:"Chat"})})]})}),e.jsx(Ne,{children:f&&f.map((t,o)=>e.jsxs(te,{hover:!0,children:[e.jsx(b,{onClick:()=>{he(t.subject,t.description,t.status)},style:{cursor:"pointer"},children:e.jsxs(n,{children:[e.jsx(l,{variant:"h6",fontWeight:"500",wrap:!0,children:t.subject}),e.jsx(l,{color:"textSecondary",noWrap:!0,sx:{maxWidth:"250px"},variant:"subtitle2",fontWeight:"400",children:t.ticketDescription})]})}),e.jsx(b,{children:e.jsx(Re,{sx:{backgroundColor:t.status==="Open"?c=>c.palette.success.light:t.status==="Closed"?c=>c.palette.error.light:t.status==="On Hold"?c=>c.palette.warning.light:t.status==="Pending"},size:"small",label:t.status==="Open"?"New":`${t.status}`})}),t.status==="Closed"?e.jsx(b,{children:e.jsx(se,{color:"secondary",badgeContent:0,children:e.jsx(le,{})})}):e.jsx(b,{component:Te,to:`/dashboards/novel_tickets_chat/${t.name}/${t.subject}`,children:e.jsx(se,{color:"secondary",badgeContent:0,children:e.jsx(ae,{})})})]},o))})]})}),e.jsx(n,{my:3,display:"flex",justifyContent:"center",children:e.jsx(Be,{count:i,color:"primary",onChange:ue})}),e.jsx(He,{open:s,onClose:F,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:e.jsxs(n,{sx:rt,children:[e.jsxs(n,{children:[e.jsx(l,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline"},children:"Ticket Name:"}),e.jsx(l,{id:"modal-modal-title",children:H})]}),e.jsxs(n,{children:[e.jsx(l,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline",marginTop:"0.5rem"},children:"Ticket Description:"}),e.jsx(l,{id:"modal-modal-description",children:A||"No Description"})]}),e.jsxs(n,{children:[e.jsx(l,{id:"modal-modal-title",variant:"h6",component:"h2",style:{textDecoration:"underline",marginTop:"0.5rem"},children:"Ticket Status:"}),e.jsx(l,{id:"modal-modal-description",children:ce})]}),e.jsx(re,{children:e.jsx(_,{onClick:F,children:"Close"})})]})}),e.jsxs(Ae,{fullWidth:!0,maxWidth:"sm",open:v,onClose:W,children:[e.jsx(Me,{children:"Rise a Ticket"}),e.jsx(Ve,{children:e.jsxs(n,{noValidate:!0,component:"form",sx:{display:"flex",flexDirection:"column",m:"auto",width:"90%"},children:[e.jsx(n,{children:e.jsx(O,{id:"standard-basic",label:"Ticket Title",variant:"standard",style:{width:"100%"},onChange:t=>{q()}})}),e.jsx(n,{sx:{mt:3},children:e.jsx(O,{id:"outlined-multiline-static",label:"Ticket Description",multiline:!0,rows:4,style:{width:"100%"},onChange:t=>{q()}})}),e.jsx(We,{disableFocusListener:!0,disableTouchListener:!0,placement:"right-end",TransitionComponent:Fe,title:"Property for which you want to rise ticket",children:r&&e.jsx(n,{children:e.jsxs(U,{fullWidth:!0,sx:{mt:3},children:[e.jsx(X,{id:"demo-simple-select-label",children:"Property Location"}),e.jsx(Y,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:h,label:"Property Location",onChange:M,children:r.map((t,o)=>e.jsx(ee,{value:t,children:t=="NTP"?"Kudlu gate":t},o))})]})})}),e.jsx(_,{variant:"contained",sx:{mt:3},onClick:fe,children:"Submit"})]})}),e.jsx(re,{children:e.jsx(_,{onClick:W,children:"Close"})})]}),e.jsx(Oe,{position:"top-center",autoClose:1e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"})]})},at=it,ot=[{to:"/dashboards/noveldashboard",title:"Home"},{title:"Tickets"}];function ms(){const a=T(d=>d.novelprofileReducer.userEmail),i=T(d=>d.novelprofileReducer.userName),r=T(d=>d.novelprofileReducer.location),[m,h]=p.useState(r);p.useEffect(()=>{let d=localStorage.getItem("location");d!=="Property Location"&&h(d)},[r]),m===null&&h("ALL");const{data:j}=y("Issue",[["raised_by","=",a],m==="ALL"?null:["location","=",m]],!1),v=Math.ceil(j/10)||1;var s=(()=>{const{data:d,error:w,isValidating:B,mutate:H}=_e("Customer",`${i}`);return d==null?void 0:d.leads.map(L=>L.confirmed_location)})();return s==null||s.unshift("ALL"),e.jsxs(we,{title:"Tickets App",description:"this is Note page",children:[e.jsx(Se,{title:"Tickets app",items:ot}),e.jsxs(Le,{children:[e.jsx(qe,{userEmail:a,filterLocation:m}),e.jsx(at,{userEmail:a,totalPages:v,confirmedLocations:s,filterLocation:m,setFilterLocation:h})]})]})}export{ms as default};
